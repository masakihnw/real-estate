# 所在階・総戸数・権利形態（所有権）の取得元

Notion に送っている「所在階」「総戸数」「権利形態」がどこまで取れているかのメモ。

## 所在階 (floor_position)

| 取得元 | 状況 |
|--------|------|
| **SUUMO** | 一覧の詳細ブロックで「所在階」「階」ラベルから取得。cassette 形式では本文の「○階」をパース。詳細ページの `parse_suumo_detail_html` でも取得可能（一覧では未使用）。 |
| **HOME'S** | 一覧の表・span から「○階」をパースして取得。 |

→ **一覧HTMLに「○階」が出ていれば取れる。** レイアウトによっては None になる場合あり。

---

## 総戸数 (total_units)

| 取得元 | 状況 |
|--------|------|
| **SUUMO** | **一覧には総戸数が出ない。** 詳細ページのHTMLに「総戸数○戸」がある。`scripts/build_units_cache.py` を実行すると、詳細ページを取得して `data/building_units.json` にキャッシュし、`apply_conditions` で `r.total_units` にマージされる。**キャッシュを事前に作っていないと SUUMO の総戸数はほぼ全て None。** |
| **HOME'S** | 一覧に「総戸数○戸」の表記があれば `_parse_total_units` で取得。 |

→ **SUUMO の総戸数**: 定期実行（`update_listings.sh`）に `build_units_cache.py` を組み込んであり、**毎回 latest.json 取得後に総戸数キャッシュ（data/building_units.json）を更新**する。次回実行時のフィルタ・Notion 同期で総戸数が利用される。キャッシュはコミットされ次回実行時に読み込まれる。

---

## 権利形態（所有権かどうか）(ownership)

| 取得元 | 状況 |
|--------|------|
| **SUUMO** | 一覧の**詳細ブロック**で「権利形態」ラベルから取得（所有権・借地権・底地権等）。**cassette 形式の一覧では権利列が無いため None。** |
| **HOME'S** | 一覧の「権利」「権利形態」セルや本文から `_parse_ownership` で「所有権|借地権|底地権」等をマッチして取得。 |

→ **一覧に「権利形態」列が出ているレイアウトなら取れる。** 表示されていないと None（Notion では「不明」として送る）。
