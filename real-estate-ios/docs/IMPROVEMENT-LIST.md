# 改善候補一覧

実装・デザイン・UI/UX・機能・非機能の観点から、改善可能な箇所を整理しました。

> **最終更新**: 2026-02-11（Phase 19 包括的品質改善後）

---

## 1. デザイン

### ✅ D1. DesignSystem とカラースキーム — 対応済み
- `DesignSystem.swift` にアクセントカラー・セマンティックカラー定数を定義済み。

### ✅ D2. Dynamic Type 完全対応 — 対応済み
- `.system(size:)` → システムフォントスタイル（`.caption`, `.footnote`, `.body` 等）に全箇所置換済み。

### D3. ダークモード固定 — スキップ
- ユーザー指示によりライトモード固定のまま。

### ✅ D4. 通勤バッジの色 — 対応済み
- `DesignSystem` に定数として切り出し済み。

### ✅ D5. 価格色の一貫性 — 対応済み
- `DesignSystem.positiveColor` / `negativeColor` で統一済み。

---

## 2. UI/UX

### U1. 一覧行の情報密度 — 検討中
- 現状のカード表示を維持。将来的に簡易/詳細表示切替を検討。

### ✅ U2. フィルタのタブ間共有 — 対応済み
- `FilterStore` (`@Observable` シングルトン) で全タブ共有。

### ✅ U3. コメントセクション配置 — 対応済み
- 物件情報・通勤・ハザード・写真の後にコメントを配置。

### ✅ U4. 現在地ボタン — 対応済み
- 地図オーバーレイに現在地ボタン追加済み。

### ✅ U5. 空状態の案内 — 対応済み
- 「今すぐ更新」ボタン付きの空状態表示、フィルタ結果ゼロ件の専用 UI 実装済み。

### ✅ U6. 更新状態表示 — 対応済み
- HH:mm 形式で表示。

### U7. フィルタ結果プレビュー — 将来課題
- 条件変更時の件数表示は実装済み。差分表示は将来検討。

### ✅ U8. お気に入り 0 件時のチップバー — 対応済み
- 0 件時はチップバー非表示。

---

## 3. 機能

### ✅ F1. 検索機能 — 対応済み
- 物件名でのインクリメンタル検索（`.searchable` モディファイア）。

### ✅ F2. 駅フィルタ — 対応済み
- フィルタシートに「駅名」アコーディオンを追加。

### ✅ F3. 物件比較 — 対応済み
- 最大4件の横並び比較（`ComparisonView`）。

### F4. カラースキーム切り替え — スキップ
- D3 関連のため不要（ユーザー指示）。

### ✅ F5. エクスポート — 対応済み
- お気に入り一覧の CSV エクスポート（`ShareLink`）。

---

## 4. 実装・アーキテクチャ

### ✅ I1. Listing モデル整理 — 対応済み
- MARK セクションで整理。

### ✅ I2. FlowLayout 重複 — 対応済み
- `Design/FlowLayout.swift` に共通化。

### ✅ I3. フィルタロジック・新築価格バグ — 対応済み
- 地図の新築価格帯フィルタを範囲交差判定に修正。

### ✅ I4. try? save → エラーハンドリング — 対応済み
- 全箇所で `do/catch` + エラーログに改善。

### I5. FirebaseSyncService 責務分離 — 将来課題
- MARK セクションで明確化済み。テスト追加時に分離を検討。

### I6. 駅名パースのテスト — 将来課題（N1 依存）

---

## 5. 非機能

### N1. 単体テスト — 将来課題
- 重要ロジック（`ListingFilter`, `parsedStations`, `LoanCalculator` 等）のテスト追加を予定。

### ✅ N2. エラーハンドリング一貫性 — 大幅改善済み
- `fatalError` の削減、`try?` → `do/catch` への統一、日本語エラーメッセージの追加。

### N3. オフライン挙動の明文化 — 将来課題
- DB-STRATEGY.md に記載済み。UI への明示は将来検討。

### N4. パフォーマンス監視 — 将来課題

### N5. アクセシビリティ網羅性 — 一部対応済み
- 一覧行・地図ピン・比較画面に `accessibilityLabel` / `accessibilityHint` 追加。
- ハザードバッジ・フィルタチップの網羅は VoiceOver テスト時に確認予定。

---

## 6. 優先度の目安（残課題のみ）

| 優先度 | 項目 | 理由 |
|--------|------|------|
| 中 | N1, I6 | テスト追加で品質保証 |
| 低 | U1, U7, I5, N3, N4, N5 | 将来的な改善候題 |

---

## 7. 参照

- [REQUIREMENTS.md](REQUIREMENTS.md)
- [TODO.md](TODO.md)
- [DB-STRATEGY.md](DB-STRATEGY.md)
